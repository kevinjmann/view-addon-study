image: adimit/docker-node-chromium:latest

stages:
  - setup
  - test
  - build
  - dist

npm:
  stage: setup
  script:
    - mkdir -p /cache/node_modules
    - ln -s /cache/node_modules ${CI_PROJECT_DIR}
    - npm install
  tags:
    - node

# karma:
#   stage: test
#   script:
#     - mkdir -p /cache/node_modules
#     - ln -s /cache/node_modules ${CI_PROJECT_DIR}/node_modules
#     - npm run test
#   tags:
#     - node
#     - chromium-headless

webpack:
  stage: build
  script:
    - mkdir -p /cache/node_modules
    - ln -s /cache/node_modules ${CI_PROJECT_DIR}
    - ls -R node_modules
    - npm run build
  artifacts:
    paths:
      - addon
#  only:
#    - master

webext:
  stage: dist
  script:
    - mkdir -p /cache/node_modules
    - ln -s /cache/node_modules ${CI_PROJECT_DIR}
    - ls -R node_modules
    - npm run bundle
    - ls -R addon
#  only:
#    - master
