image: adimit/docker-node-chromium:latest

stages:
  - setup
  - test
  - build
  - dist

cache:
  untracked: true
  key: "$CI_COMMIT_REF_NAME"
  paths:
    - "./node-modules"

npm:
  stage: setup
  script:
    - npm install
  tags:
    - node

karma:
  stage: test
  script:
    - npm run test
  tags:
    - node
    - chromium-headless

webpack:
  stage: build
  script:
    - npm run build
  artifacts:
    expire_in: 1 hour
    paths:
      - addon
  tags:
    - node
#  only:
#    - master

webext:
  stage: dist
  script:
    - npm run bundle
    - mkdir dist/view-addon && cd dist/view-addon && unzip ../*zip
  tags:
    - node
  artifacts:
    expire_in: 1 week
    paths:
      - dist/view-addon
#  only:
#    - master
